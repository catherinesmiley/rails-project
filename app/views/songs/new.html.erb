<% if @song.errors.any? %>
    <div id="field_with_errors">
        <h2><%= pluralize(@song.errors.count, "error") %> prohibited this song from being created:</h2>

        <ul>
            <% @song.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
        </ul>
    </div>
<% end %>

<h2>Create a new song: </h2>

<%= form_for @song do |f| %>
    <% if @playlist %>
        <%= hidden_field_tag "song[playlist_ids][]", @playlist.id %>
    <% else %>
        <h3>Add this song to one or more of your playlists: </h3>
        <%= f.collection_check_boxes :playlist_ids, Playlist.all, :id, :name %><p>
    <% end %>
    <%= f.label :title %>
    <%= f.text_field :title %><p>
    <%= f.label :artist %>
    <%= f.text_field :artist %><p>
    <%= f.label :genre %>
    <%= f.text_field :genre %><p>

    <%= f.fields_for :categories do |category| %>
        <%= hidden_field_tag "song[categories_attributes][0][playlist_id]", @playlist.id %>
    <%= category.label :category %>
    <%= category.text_field :name %><p>
    <% end %>

    <%= f.submit "Add song" %>
<% end %>